(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{752:function(e,a,t){"use strict";t.r(a);var l=t(1),c=Object(l.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"adr-029-fee-grant-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#adr-029-fee-grant-module"}},[e._v("#")]),e._v(" ADR 029: Fee Grant Module")]),e._v(" "),t("h2",{attrs:{id:"changelog"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#changelog"}},[e._v("#")]),e._v(" Changelog")]),e._v(" "),t("ul",[t("li",[e._v("2020/08/18: Initial Draft")])]),e._v(" "),t("h2",{attrs:{id:"status"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#status"}},[e._v("#")]),e._v(" Status")]),e._v(" "),t("p",[e._v("Accepted")]),e._v(" "),t("h2",{attrs:{id:"context"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[e._v("#")]),e._v(" Context")]),e._v(" "),t("p",[e._v("In order to make blockchain transactions, the signing account must possess a sufficient balance of the right denomination\nin order to pay fees. There are classes of transactions where needing to maintain a wallet with sufficient fees is a\nbarrier to adoption.")]),e._v(" "),t("p",[e._v('For instance, when proper permissions are setup, someone may temporarily delegate the ability to vote on proposals to\na "burner" account that is stored on a mobile phone with only minimal security.')]),e._v(" "),t("p",[e._v("Other use cases include workers tracking items in a supply chain or farmers submitting field data for analytics\nor compliance purposes.")]),e._v(" "),t("p",[e._v("For all of these use cases, UX would be significantly enhanced by obviating the need for these accounts to always\nmaintain the appropriate fee balance. This is especially true if we wanted to achieve enterprise adoption for something\nlike supply chain tracking.")]),e._v(" "),t("p",[e._v('While one solution would be to have a service that fills up these accounts automatically with the appropriate fees, a better UX\nwould be provided by allowing these accounts to pull from a common fee pool account with proper spending limits.\nA single pool would reduce the churn of making lots of small "fill up" transactions and also more effectively leverages\nthe resources of the organization setting up the pool.')]),e._v(" "),t("h2",{attrs:{id:"decision"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#decision"}},[e._v("#")]),e._v(" Decision")]),e._v(" "),t("p",[e._v("As a solution we propose a module, "),t("code",[e._v("x/feegrant")]),e._v(' which allows one account, the "granter" to grant another account, the "grantee"\nan allowance to spend the granter\'s account balance for fees within certain well-defined limits.')]),e._v(" "),t("p",[e._v("Fee allowances are defined by the extensible "),t("code",[e._v("FeeAllowanceI")]),e._v(" interface:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBGZWVBbGxvd2FuY2VJIHsKICAgIC8vIEFjY2VwdCBjYW4gdXNlIGZlZSBwYXltZW50IHJlcXVlc3RlZCBhcyB3ZWxsIGFzIHRpbWVzdGFtcC9oZWlnaHQgb2YgdGhlIGN1cnJlbnQgYmxvY2sKIAkvLyB0byBkZXRlcm1pbmUgd2hldGhlciBvciBub3QgdG8gcHJvY2VzcyB0aGlzLiBUaGlzIGlzIGNoZWNrZWQgaW4KIAkvLyBLZWVwZXIuVXNlR3JhbnRlZEZlZXMgYW5kIHRoZSByZXR1cm4gdmFsdWVzIHNob3VsZCBtYXRjaCBob3cgaXQgaXMgaGFuZGxlZCB0aGVyZS4KIAkvLwogCS8vIElmIGl0IHJldHVybnMgYW4gZXJyb3IsIHRoZSBmZWUgcGF5bWVudCBpcyByZWplY3RlZCwgb3RoZXJ3aXNlIGl0IGlzIGFjY2VwdGVkLgogCS8vIFRoZSBGZWVBbGxvd2FuY2UgaW1wbGVtZW50YXRpb24gaXMgZXhwZWN0ZWQgdG8gdXBkYXRlIGl0J3MgaW50ZXJuYWwgc3RhdGUKIAkvLyBhbmQgd2lsbCBiZSBzYXZlZCBhZ2FpbiBhZnRlciBhbiBhY2NlcHRhbmNlLgogCS8vCiAJLy8gSWYgcmVtb3ZlIGlzIHRydWUgKHJlZ2FyZGxlc3Mgb2YgdGhlIGVycm9yKSwgdGhlIEZlZUFsbG93YW5jZSB3aWxsIGJlIGRlbGV0ZWQgZnJvbSBzdG9yYWdlCiAJLy8gKGVnLiB3aGVuIGl0IGlzIHVzZWQgdXApLiAoU2VlIGNhbGwgdG8gUmV2b2tlRmVlQWxsb3dhbmNlIGluIEtlZXBlci5Vc2VHcmFudGVkRmVlcykKIAlBY2NlcHQoZmVlIHNkay5Db2lucywgYmxvY2tUaW1lIHRpbWUuVGltZSwgYmxvY2tIZWlnaHQgaW50NjQpIChyZW1vdmUgYm9vbCwgZXJyIGVycm9yKQp9Cg=="}}),e._v(" "),t("p",[e._v("Two basic fee allowance types, "),t("code",[e._v("BasicFeeAllowance")]),e._v(" and "),t("code",[e._v("PeriodicFeeAllowance")]),e._v(" are defined to support known use cases:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"proto",base64:"Ly8gQmFzaWNGZWVBbGxvd2FuY2UgaW1wbGVtZW50cyBGZWVBbGxvd2FuY2Ugd2l0aCBhIG9uZS10aW1lIGdyYW50IG9mIHRva2VucwovLyB0aGF0IG9wdGlvbmFsbHkgZXhwaXJlcy4gVGhlIGRlbGVnYXRlZSBjYW4gdXNlIHVwIHRvIFNwZW5kTGltaXQgdG8gY292ZXIgZmVlcy4KbWVzc2FnZSBCYXNpY0ZlZUFsbG93YW5jZSB7CgkvLyBzcGVuZF9saW1pdCBzcGVjaWZpZXMgdGhlIG1heGltdW0gYW1vdW50IG9mIHRva2VucyB0aGF0IGNhbiBiZSBzcGVudAoJLy8gYnkgdGhpcyBhbGxvd2FuY2UgYW5kIHdpbGwgYmUgdXBkYXRlZCBhcyB0b2tlbnMgYXJlIHNwZW50LiBJZiBpdCBpcwoJLy8gZW1wdHksIHRoZXJlIGlzIG5vIHNwZW5kIGxpbWl0IGFuZCBhbnkgYW1vdW50IG9mIGNvaW5zIGNhbiBiZSBzcGVudC4KICAgIHJlcGVhdGVkIGNvc21vc19zZGsudjEuQ29pbiBzcGVuZF9saW1pdCA9IDE7CgogICAgLy8gZXhwaXJlc19hdCBzcGVjaWZpZXMgYW4gb3B0aW9uYWwgdGltZSB3aGVuIHRoaXMgYWxsb3dhbmNlIGV4cGlyZXMKICAgIEV4cGlyZXNBdCBleHBpcmF0aW9uID0gMjsKfQoKLy8gUGVyaW9kaWNGZWVBbGxvd2FuY2UgZXh0ZW5kcyBGZWVBbGxvd2FuY2UgdG8gYWxsb3cgZm9yIGJvdGggYSBtYXhpbXVtIGNhcCwKLy8gYXMgd2VsbCBhcyBhIGxpbWl0IHBlciB0aW1lIHBlcmlvZC4KbWVzc2FnZSBQZXJpb2RpY0ZlZUFsbG93YW5jZSB7CiAgICAgQmFzaWNGZWVBbGxvd2FuY2UgYmFzaWMgPSAxOwoKICAgICAvLyBwZXJpb2Qgc3BlY2lmaWVzIHRoZSB0aW1lIGR1cmF0aW9uIGluIHdoaWNoIHBlcmlvZF9zcGVuZF9saW1pdCBjb2lucyBjYW4KICAgICAvLyBiZSBzcGVudCBiZWZvcmUgdGhhdCBhbGxvd2FuY2UgaXMgcmVzZXQKICAgICBEdXJhdGlvbiBwZXJpb2QgPSAyOwogCiAgICAgLy8gcGVyaW9kX3NwZW5kX2xpbWl0IHNwZWNpZmllcyB0aGUgbWF4aW11bSBudW1iZXIgb2YgY29pbnMgdGhhdCBjYW4gYmUgc3BlbnQKICAgICAvLyBpbiB0aGUgcGVyaW9kCiAgICAgcmVwZWF0ZWQgY29zbW9zX3Nkay52MS5Db2luIHBlcmlvZF9zcGVuZF9saW1pdCA9IDM7CgogICAgIC8vIHBlcmlvZF9jYW5fc3BlbmQgaXMgdGhlIG51bWJlciBvZiBjb2lucyBsZWZ0IHRvIGJlIHNwZW50IGJlZm9yZSB0aGUgcGVyaW9kX3Jlc2V0IHRpbWUKICAgICByZXBlYXRlZCBjb3Ntb3Nfc2RrLnYxLkNvaW4gcGVyaW9kX2Nhbl9zcGVuZCA9IDQ7CiAKICAgICAvLyBwZXJpb2RfcmVzZXQgaXMgdGhlIHRpbWUgYXQgd2hpY2ggdGhpcyBwZXJpb2QgcmVzZXRzIGFuZCBhIG5ldyBvbmUgYmVnaW5zLAogICAgIC8vIGl0IGlzIGNhbGN1bGF0ZWQgZnJvbSB0aGUgc3RhcnQgdGltZSBvZiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gYWZ0ZXIgdGhlCiAgICAgLy8gbGFzdCBwZXJpb2QgZW5kZWQKICAgICBFeHBpcmVzQXQgcGVyaW9kX3Jlc2V0ID0gNTsKfQoKLy8gRXhwaXJlc0F0IGlzIGEgcG9pbnQgaW4gdGltZSB3aGVyZSBzb21ldGhpbmcgZXhwaXJlcy4KLy8gSXQgbWF5IGJlICplaXRoZXIqIGJsb2NrIHRpbWUgb3IgYmxvY2sgaGVpZ2h0Cm1lc3NhZ2UgRXhwaXJlc0F0IHsKICAgICBvbmVvZiBzdW0gewogICAgICAgZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcCB0aW1lID0gMTsKICAgICAgIHVpbnQ2NCBoZWlnaHQgPSAyOwogICAgIH0KIH0KCi8vIER1cmF0aW9uIGlzIGEgcmVwZWF0aW5nIHVuaXQgb2YgZWl0aGVyIGNsb2NrIHRpbWUgb3IgbnVtYmVyIG9mIGJsb2Nrcy4KbWVzc2FnZSBEdXJhdGlvbiB7CiAgICBvbmVvZiBzdW0gewogICAgICBnb29nbGUucHJvdG9idWYuRHVyYXRpb24gZHVyYXRpb24gPSAxOwogICAgICB1aW50NjQgYmxvY2tzID0gMjsKICAgIH0KfQoK"}}),e._v(" "),t("p",[e._v("Allowances can be granted and revoked using "),t("code",[e._v("MsgGrantFeeAllowance")]),e._v(" and "),t("code",[e._v("MsgRevokeFeeAllowance")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"proto",base64:"bWVzc2FnZSBNc2dHcmFudEZlZUFsbG93YW5jZSB7CiAgICAgc3RyaW5nIGdyYW50ZXIgPSAxOwogICAgIHN0cmluZyBncmFudGVlID0gMjsKICAgICBnb29nbGUucHJvdG9idWYuQW55IGFsbG93YW5jZSA9IDM7CiB9CgogLy8gTXNnUmV2b2tlRmVlQWxsb3dhbmNlIHJlbW92ZXMgYW55IGV4aXN0aW5nIEZlZUFsbG93YW5jZSBmcm9tIEdyYW50ZXIgdG8gR3JhbnRlZS4KIG1lc3NhZ2UgTXNnUmV2b2tlRmVlQWxsb3dhbmNlIHsKICAgICBzdHJpbmcgZ3JhbnRlciA9IDE7CiAgICAgc3RyaW5nIGdyYW50ZWUgPSAyOwogfQo="}}),e._v(" "),t("p",[e._v("In order to use allowances in transactions, we add a new field "),t("code",[e._v("granter")]),e._v(" to the transaction "),t("code",[e._v("Fee")]),e._v(" type:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"proto",base64:"cGFja2FnZSBjb3Ntb3MudHgudjFiZXRhMTsKCm1lc3NhZ2UgRmVlIHsKICByZXBlYXRlZCBjb3Ntb3MuYmFzZS52MWJldGExLkNvaW4gYW1vdW50ID0gMTsKICB1aW50NjQgZ2FzX2xpbWl0ID0gMjsKICBzdHJpbmcgcGF5ZXIgPSAzOwogIHN0cmluZyBncmFudGVyID0gNDsKfQo="}}),e._v(" "),t("p",[t("code",[e._v("granter")]),e._v(" must either be left empty or must correspond to an account which has granted\na fee allowance to fee payer (either the first signer or the value of the "),t("code",[e._v("payer")]),e._v(" field).")]),e._v(" "),t("p",[e._v("A new "),t("code",[e._v("AnteDecorator")]),e._v(" named "),t("code",[e._v("DeductGrantedFeeDecorator")]),e._v(" will be created in order to process transactions with "),t("code",[e._v("fee_payer")]),e._v("\nset and correctly deduct fees based on fee allowances.")]),e._v(" "),t("h2",{attrs:{id:"consequences"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#consequences"}},[e._v("#")]),e._v(" Consequences")]),e._v(" "),t("h3",{attrs:{id:"positive"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#positive"}},[e._v("#")]),e._v(" Positive")]),e._v(" "),t("ul",[t("li",[e._v("improved UX for use cases where it is cumbersome to maintain an account balance just for fees")])]),e._v(" "),t("h3",{attrs:{id:"negative"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#negative"}},[e._v("#")]),e._v(" Negative")]),e._v(" "),t("h3",{attrs:{id:"neutral"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#neutral"}},[e._v("#")]),e._v(" Neutral")]),e._v(" "),t("ul",[t("li",[e._v("a new field must be added to the transaction "),t("code",[e._v("Fee")]),e._v(" message and a new "),t("code",[e._v("AnteDecorator")]),e._v(" must be\ncreated to use it")])]),e._v(" "),t("h2",{attrs:{id:"references"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),t("ul",[t("li",[e._v("Blog article describing initial work: https://medium.com/regen-network/hacking-the-cosmos-cosmwasm-and-key-management-a08b9f561d1b")]),e._v(" "),t("li",[e._v("Initial public specification: https://gist.github.com/aaronc/b60628017352df5983791cad30babe56")]),e._v(" "),t("li",[e._v("Original subkeys proposal from B-harvest which influenced this design: https://github.com/cosmos/cosmos-sdk/issues/4480")])])],1)}),[],!1,null,null,null);a.default=c.exports}}]);