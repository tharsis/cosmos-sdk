(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{687:function(e,t,o){"use strict";o.r(t);var a=o(1),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"module-interfaces"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#module-interfaces"}},[e._v("#")]),e._v(" Module Interfaces")]),e._v(" "),o("h2",{attrs:{hide:"",id:"pre-requisite-readings"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#pre-requisite-readings"}},[e._v("#")]),e._v(" Pre-requisite Readings")]),e._v(" "),o("ul",[o("li",{attrs:{prereq:""}},[o("RouterLink",{attrs:{to:"/building-modules/intro.html"}},[e._v("Building Modules Intro")])],1)]),e._v(" "),o("h2",{attrs:{id:"cli"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#cli"}},[e._v("#")]),e._v(" CLI")]),e._v(" "),o("p",[e._v("One of the main interfaces for an application is the "),o("RouterLink",{attrs:{to:"/interfaces/cli.html"}},[e._v("command-line interface")]),e._v(". This entrypoint adds commands from the application's modules to let end-users create "),o("RouterLink",{attrs:{to:"/building-modules/messages-and-queries.html#messages"}},[o("strong",[e._v("messages")])]),e._v(" and "),o("RouterLink",{attrs:{to:"/building-modules/messages-and-queries.html#queries"}},[o("strong",[e._v("queries")])]),e._v(".  The CLI files are typically found in the "),o("code",[e._v("./x/moduleName/client/cli")]),e._v(" folder.")],1),e._v(" "),o("h3",{attrs:{id:"transaction-commands"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#transaction-commands"}},[e._v("#")]),e._v(" Transaction Commands")]),e._v(" "),o("p",[o("RouterLink",{attrs:{to:"/core/transactions.html"}},[e._v("Transactions")]),e._v(" are created by users to wrap messages that trigger state changes when they get included in a valid block. Transaction commands typically have their own "),o("code",[e._v("tx.go")]),e._v(" file in the module "),o("code",[e._v("./x/moduleName/client/cli")]),e._v(" folder. The commands are specified in getter functions prefixed with "),o("code",[e._v("GetCmd")]),e._v(" and include the name of the command.")],1),e._v(" "),o("p",[e._v("Here is an example from the "),o("code",[e._v("nameservice")]),e._v(" module:")]),e._v(" "),o("p",[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gR2V0Q21kQnV5TmFtZSBpcyB0aGUgQ0xJIGNvbW1hbmQgZm9yIHNlbmRpbmcgYSBCdXlOYW1lIHRyYW5zYWN0aW9uCmZ1bmMgR2V0Q21kQnV5TmFtZShjZGMgKmNvZGVjLkNvZGVjKSAqY29icmEuQ29tbWFuZCB7CglyZXR1cm4gJmFtcDtjb2JyYS5Db21tYW5kewoJCVVzZTogICAmcXVvdDtidXktbmFtZSBbbmFtZV0gW2Ftb3VudF0mcXVvdDssCgkJU2hvcnQ6ICZxdW90O2JpZCBmb3IgZXhpc3RpbmcgbmFtZSBvciBjbGFpbSBuZXcgbmFtZSZxdW90OywKCQlBcmdzOiAgY29icmEuRXhhY3RBcmdzKDIpLAoJCVJ1bkU6IGZ1bmMoY21kICpjb2JyYS5Db21tYW5kLCBhcmdzIFtdc3RyaW5nKSBlcnJvciB7CgkJCWNsaUN0eCA6PSBjb250ZXh0Lk5ld0NMSUNvbnRleHQoKS5XaXRoQ29kZWMoY2RjKQoKCQkJdHhCbGRyIDo9IGF1dGguTmV3VHhCdWlsZGVyRnJvbUNMSSgpLldpdGhUeEVuY29kZXIodXRpbHMuR2V0VHhFbmNvZGVyKGNkYykpCgoJCQljb2lucywgZXJyIDo9IHNkay5QYXJzZUNvaW5zKGFyZ3NbMV0pCgkJCWlmIGVyciAhPSBuaWwgewoJCQkJcmV0dXJuIGVycgoJCQl9CgoJCQltc2cgOj0gdHlwZXMuTmV3TXNnQnV5TmFtZShhcmdzWzBdLCBjb2lucywgY2xpQ3R4LkdldEZyb21BZGRyZXNzKCkpCgkJCWVyciA9IG1zZy5WYWxpZGF0ZUJhc2ljKCkKCQkJaWYgZXJyICE9IG5pbCB7CgkJCQlyZXR1cm4gZXJyCgkJCX0KCgkJCXJldHVybiB1dGlscy5HZW5lcmF0ZU9yQnJvYWRjYXN0TXNncyhjbGlDdHgsIHR4QmxkciwgW11zZGsuTXNne21zZ30pCgkJfSwKCX0KfQ=="}})],1),e._v(" "),o("p",[e._v("This getter function creates the command for the Buy Name transaction. It does the following:")]),e._v(" "),o("ul",[o("li",[o("strong",[e._v("Construct the command:")]),e._v(" Read the "),o("a",{attrs:{href:"https://github.com/spf13/cobra",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cobra Documentation"),o("OutboundLink")],1),e._v(" for details on how to create commands.\n"),o("ul",[o("li",[o("strong",[e._v("Use:")]),e._v(" Specifies the format of a command-line entry users should type in order to invoke this command. In this case, the user uses "),o("code",[e._v("buy-name")]),e._v(" as the name of the transaction command and provides the "),o("code",[e._v("name")]),e._v(" the user wishes to buy and the "),o("code",[e._v("amount")]),e._v(" the user is willing to pay.")]),e._v(" "),o("li",[o("strong",[e._v("Args:")]),e._v(" The number of arguments the user provides, in this case exactly two: "),o("code",[e._v("name")]),e._v(" and "),o("code",[e._v("amount")]),e._v(".")]),e._v(" "),o("li",[o("strong",[e._v("Short and Long:")]),e._v(" A description for the function is provided here. A "),o("code",[e._v("Short")]),e._v(" description is expected, and "),o("code",[e._v("Long")]),e._v(" can be used to provide a more detailed description when a user uses the "),o("code",[e._v("--help")]),e._v(" flag to ask for more information.")]),e._v(" "),o("li",[o("strong",[e._v("RunE:")]),e._v(" Defines a function that can return an error, called when the command is executed. Using "),o("code",[e._v("Run")]),e._v(" would do the same thing, but would not allow for errors to be returned.")])])]),e._v(" "),o("li",[o("strong",[o("code",[e._v("RunE")]),e._v(" Function Body:")]),e._v(" The function should be specified as a "),o("code",[e._v("RunE")]),e._v(" to allow for errors to be returned. This function encapsulates all of the logic to create a new transaction that is ready to be relayed to nodes.\n"),o("ul",[o("li",[e._v("The function should first initialize a "),o("RouterLink",{attrs:{to:"/core/transactions.html#txbuilder"}},[o("code",[e._v("TxBuilder")])]),e._v(" with the application "),o("code",[e._v("codec")]),e._v("'s "),o("code",[e._v("TxEncoder")]),e._v(", as well as a new "),o("RouterLink",{attrs:{to:"/interfaces/query-lifecycle.html#clicontext"}},[o("code",[e._v("CLIContext")])]),e._v(" with the "),o("code",[e._v("codec")]),e._v(" and "),o("code",[e._v("AccountDecoder")]),e._v(". These contexts contain all the information provided by the user and will be used to transfer this user-specific information between processes. To learn more about how contexts are used in a transaction, click "),o("RouterLink",{attrs:{to:"/core/transactions.html#transaction-generation"}},[e._v("here")]),e._v(".")],1),e._v(" "),o("li",[e._v("If applicable, the command's arguments are parsed. Here, the "),o("code",[e._v("amount")]),e._v(" given by the user is parsed into a denomination of "),o("code",[e._v("coins")]),e._v(".")]),e._v(" "),o("li",[e._v("If applicable, the "),o("code",[e._v("CLIContext")]),e._v(" is used to retrieve any parameters such as the transaction originator's address to be used in the transaction. Here, the "),o("code",[e._v("from")]),e._v(" address is retrieved by calling "),o("code",[e._v("cliCtx.getFromAddress()")]),e._v(".")]),e._v(" "),o("li",[e._v("A "),o("RouterLink",{attrs:{to:"/building-modules/messages-and-queries.html"}},[e._v("message")]),e._v(" is created using all parameters parsed from the command arguments and "),o("code",[e._v("CLIContext")]),e._v(". The constructor function of the specific message type is called directly. It is good practice to call "),o("code",[e._v("ValidateBasic()")]),e._v(" on the newly created message to run a sanity check and check for invalid arguments.")],1),e._v(" "),o("li",[e._v("Depending on what the user wants, the transaction is either generated offline or signed and broadcasted to the preconfigured node using "),o("code",[e._v("GenerateOrBroadcastMsgs()")]),e._v(".")])])]),e._v(" "),o("li",[o("strong",[e._v("Flags.")]),e._v(" Add any "),o("a",{attrs:{href:"#flags"}},[e._v("flags")]),e._v(" to the command. No flags were specified here, but all transaction commands have flags to provide additional information from the user (e.g. amount of fees they are willing to pay). These "),o("em",[e._v("persistent")]),e._v(" "),o("RouterLink",{attrs:{to:"/interfaces/cli.html#flags"}},[e._v("transaction flags")]),e._v(" can be added to a higher-level command so that they apply to all transaction commands.")],1)]),e._v(" "),o("p",[e._v("Finally, the module needs to have a "),o("code",[e._v("GetTxCmd()")]),e._v(", which aggregates all of the transaction commands of the module. Often, each command getter function has its own file in the module's "),o("code",[e._v("cli")]),e._v(" folder, and a separate "),o("code",[e._v("tx.go")]),e._v(" file contains "),o("code",[e._v("GetTxCmd()")]),e._v(". Application developers wishing to include the module's transactions will call this function to add them as subcommands in their CLI. Here is the "),o("code",[e._v("auth")]),e._v(" "),o("code",[e._v("GetTxCmd()")]),e._v(" function, which adds the "),o("code",[e._v("Sign")]),e._v(" and "),o("code",[e._v("MultiSign")]),e._v(" commands.")]),e._v(" "),o("p",[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gR2V0VHhDbWQgcmV0dXJucyB0aGUgdHJhbnNhY3Rpb24gY29tbWFuZHMgZm9yIHRoaXMgbW9kdWxlCmZ1bmMgR2V0VHhDbWQoY2RjICpjb2RlYy5Db2RlYykgKmNvYnJhLkNvbW1hbmQgewoJdHhDbWQgOj0gJmFtcDtjb2JyYS5Db21tYW5kewoJCVVzZTogICAgICAgICAgICAgICAgICAgICAgICB0eXBlcy5Nb2R1bGVOYW1lLAoJCVNob3J0OiAgICAgICAgICAgICAgICAgICAgICAmcXVvdDtBdXRoIHRyYW5zYWN0aW9uIHN1YmNvbW1hbmRzJnF1b3Q7LAoJCURpc2FibGVGbGFnUGFyc2luZzogICAgICAgICB0cnVlLAoJCVN1Z2dlc3Rpb25zTWluaW11bURpc3RhbmNlOiAyLAoJCVJ1bkU6ICAgICAgICAgICAgICAgICAgICAgICBjbGllbnQuVmFsaWRhdGVDbWQsCgl9Cgl0eENtZC5BZGRDb21tYW5kKAoJCUdldE11bHRpU2lnbkNvbW1hbmQoY2RjKSwKCQlHZXRTaWduQ29tbWFuZChjZGMpLAoJKQoJcmV0dXJuIHR4Q21kCn0="}})],1),e._v(" "),o("p",[e._v("An application using this module likely adds "),o("code",[e._v("auth")]),e._v(" module commands to its root "),o("code",[e._v("TxCmd")]),e._v(" command by calling "),o("code",[e._v("txCmd.AddCommand(authModuleClient.GetTxCmd())")]),e._v(".")]),e._v(" "),o("h3",{attrs:{id:"query-commands"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#query-commands"}},[e._v("#")]),e._v(" Query Commands")]),e._v(" "),o("p",[o("RouterLink",{attrs:{to:"/building-modules/messages-and-queries.html#queries"}},[e._v("Queries")]),e._v(" allow users to gather information about the application or network state; they are routed by the application and processed by the module in which they are defined. Query commands typically have their own "),o("code",[e._v("query.go")]),e._v(" file in the module "),o("code",[e._v("x/moduleName/client/cli")]),e._v(" folder. Like transaction commands, they are specified in getter functions and have the prefix "),o("code",[e._v("GetCmdQuery")]),e._v(". Here is an example of a query command from the "),o("code",[e._v("nameservice")]),e._v(" module:")],1),e._v(" "),o("p",[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gR2V0Q21kV2hvaXMgcXVlcmllcyBpbmZvcm1hdGlvbiBhYm91dCBhIGRvbWFpbgpmdW5jIEdldENtZFdob2lzKHF1ZXJ5Um91dGUgc3RyaW5nLCBjZGMgKmNvZGVjLkNvZGVjKSAqY29icmEuQ29tbWFuZCB7CglyZXR1cm4gJmFtcDtjb2JyYS5Db21tYW5kewoJCVVzZTogICAmcXVvdDt3aG9pcyBbbmFtZV0mcXVvdDssCgkJU2hvcnQ6ICZxdW90O1F1ZXJ5IHdob2lzIGluZm8gb2YgbmFtZSZxdW90OywKCQlBcmdzOiAgY29icmEuRXhhY3RBcmdzKDEpLAoJCVJ1bkU6IGZ1bmMoY21kICpjb2JyYS5Db21tYW5kLCBhcmdzIFtdc3RyaW5nKSBlcnJvciB7CgkJCWNsaUN0eCA6PSBjb250ZXh0Lk5ld0NMSUNvbnRleHQoKS5XaXRoQ29kZWMoY2RjKQoJCQluYW1lIDo9IGFyZ3NbMF0KCgkJCXJlcywgXywgZXJyIDo9IGNsaUN0eC5RdWVyeVdpdGhEYXRhKGZtdC5TcHJpbnRmKCZxdW90O2N1c3RvbS8lcy93aG9pcy8lcyZxdW90OywgcXVlcnlSb3V0ZSwgbmFtZSksIG5pbCkKCQkJaWYgZXJyICE9IG5pbCB7CgkJCQlmbXQuUHJpbnRmKCZxdW90O2NvdWxkIG5vdCByZXNvbHZlIHdob2lzIC0gJXMgXG4mcXVvdDssIG5hbWUpCgkJCQlyZXR1cm4gbmlsCgkJCX0KCgkJCXZhciBvdXQgdHlwZXMuV2hvaXMKCQkJY2RjLk11c3RVbm1hcnNoYWxKU09OKHJlcywgJmFtcDtvdXQpCgkJCXJldHVybiBjbGlDdHguUHJpbnRPdXRwdXQob3V0KQoJCX0sCgl9Cn0="}})],1),e._v(" "),o("p",[e._v("This query returns the address that owns a particular name. The getter function does the following:")]),e._v(" "),o("ul",[o("li",[o("strong",[o("code",[e._v("codec")]),e._v(" and "),o("code",[e._v("queryRoute")]),e._v(".")]),e._v(" In addition to taking in the application "),o("code",[e._v("codec")]),e._v(", query command getters also take a "),o("code",[e._v("queryRoute")]),e._v(" used to construct a path "),o("RouterLink",{attrs:{to:"/core/baseapp.html#query-routing"}},[e._v("Baseapp")]),e._v(" uses to route the query in the application.")],1),e._v(" "),o("li",[o("strong",[e._v("Construct the command.")]),e._v(" Read the "),o("a",{attrs:{href:"https://github.com/spf13/cobra",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cobra Documentation"),o("OutboundLink")],1),e._v(" and the "),o("a",{attrs:{href:"#transaction-commands"}},[e._v("transaction command")]),e._v(" example above for more information. The user must type "),o("code",[e._v("whois")]),e._v(" and provide the "),o("code",[e._v("name")]),e._v(" they are querying for as the only argument.")]),e._v(" "),o("li",[o("strong",[o("code",[e._v("RunE")]),e._v(".")]),e._v(" The function should be specified as a "),o("code",[e._v("RunE")]),e._v(" to allow for errors to be returned. This function encapsulates all of the logic to create a new query that is ready to be relayed to nodes.\n"),o("ul",[o("li",[e._v("The function should first initialize a new "),o("RouterLink",{attrs:{to:"/interfaces/query-lifecycle.html#clicontext"}},[o("code",[e._v("CLIContext")])]),e._v(" with the application "),o("code",[e._v("codec")]),e._v(".")],1),e._v(" "),o("li",[e._v("If applicable, the "),o("code",[e._v("CLIContext")]),e._v(" is used to retrieve any parameters (e.g. the query originator's address to be used in the query) and marshal them with the query parameter type, in preparation to be relayed to a node. There are no "),o("code",[e._v("CLIContext")]),e._v(" parameters in this case because the query does not involve any information about the user.")]),e._v(" "),o("li",[e._v("The "),o("code",[e._v("queryRoute")]),e._v(" is used to construct a "),o("code",[e._v("path")]),e._v(" "),o("RouterLink",{attrs:{to:"/core/baseapp.html"}},[o("code",[e._v("baseapp")])]),e._v(" will use to route the query to the appropriate "),o("RouterLink",{attrs:{to:"/building-modules/querier.html"}},[e._v("querier")]),e._v(". The expected format for a query "),o("code",[e._v("path")]),e._v(' is "queryCategory/queryRoute/queryType/arg1/arg2/...", where '),o("code",[e._v("queryCategory")]),e._v(" can be "),o("code",[e._v("p2p")]),e._v(", "),o("code",[e._v("store")]),e._v(", "),o("code",[e._v("app")]),e._v(", or "),o("code",[e._v("custom")]),e._v(", "),o("code",[e._v("queryRoute")]),e._v(" is the name of the module, and "),o("code",[e._v("queryType")]),e._v(" is the name of the query type defined within the module. "),o("RouterLink",{attrs:{to:"/core/baseapp.html"}},[o("code",[e._v("baseapp")])]),e._v(" can handle each type of "),o("code",[e._v("queryCategory")]),e._v(" by routing it to a module querier or retrieving results directly from stores and functions for querying peer nodes. Module queries are "),o("code",[e._v("custom")]),e._v(" type queries (some SDK modules have exceptions, such as "),o("code",[e._v("auth")]),e._v(" and "),o("code",[e._v("gov")]),e._v(" module queries).")],1),e._v(" "),o("li",[e._v("The "),o("code",[e._v("CLIContext")]),e._v(" "),o("code",[e._v("QueryWithData()")]),e._v(" function is used to relay the query to a node and retrieve the response. It requires the "),o("code",[e._v("path")]),e._v(". It returns the result and height of the query upon success or an error if the query fails. In addition, it will verify the returned proof if "),o("code",[e._v("TrustNode")]),e._v(" is disabled. If proof verification fails or the query height is invalid, an error will be returned.")]),e._v(" "),o("li",[e._v("The "),o("code",[e._v("codec")]),e._v(" is used to nmarshal the response and the "),o("code",[e._v("CLIContext")]),e._v(" is used to print the output back to the user.")])])]),e._v(" "),o("li",[o("strong",[e._v("Flags.")]),e._v(" Add any "),o("a",{attrs:{href:"#flags"}},[e._v("flags")]),e._v(" to the command.")])]),e._v(" "),o("p",[e._v("Finally, the module also needs a "),o("code",[e._v("GetQueryCmd")]),e._v(", which aggregates all of the query commands of the module. Application developers wishing to include the module's queries will call this function to add them as subcommands in their CLI. Its structure is identical to the "),o("code",[e._v("GetTxCmd")]),e._v(" command shown above.")]),e._v(" "),o("h3",{attrs:{id:"flags"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#flags"}},[e._v("#")]),e._v(" Flags")]),e._v(" "),o("p",[o("RouterLink",{attrs:{to:"/interfaces/cli.html#flags"}},[e._v("Flags")]),e._v(" are entered by the user and allow for command customizations. Examples include the "),o("RouterLink",{attrs:{to:"/basics/gas-fees.html"}},[e._v("fees")]),e._v(" or gas prices users are willing to pay for their transactions.")],1),e._v(" "),o("p",[e._v("The flags for a module are typically found in a "),o("code",[e._v("flags.go")]),e._v(" file in the "),o("code",[e._v("./x/moduleName/client/cli")]),e._v(" folder. Module developers can create a list of possible flags including the value type, default value, and a description displayed if the user uses a "),o("code",[e._v("help")]),e._v(" command. In each transaction getter function, they can add flags to the commands and, optionally, mark flags as "),o("em",[e._v("required")]),e._v(" so that an error is thrown if the user does not provide values for them.")]),e._v(" "),o("p",[e._v("For full details on flags, visit the "),o("a",{attrs:{href:"https://github.com/spf13/cobra",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cobra Documentation"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("For example, the SDK "),o("code",[e._v("./client/flags")]),e._v(" package includes a "),o("code",[e._v("PostCommands()")]),e._v(" function that adds necessary flags to transaction commands, such as the "),o("code",[e._v("from")]),e._v(" flag to indicate which address the transaction originates from.")]),e._v(" "),o("p",[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBQb3N0Q29tbWFuZHMoY21kcyAuLi4qY29icmEuQ29tbWFuZCkgW10qY29icmEuQ29tbWFuZCB7Cglmb3IgXywgYyA6PSByYW5nZSBjbWRzIHsKCQljLkZsYWdzKCkuQm9vbChGbGFnSW5kZW50UmVzcG9uc2UsIGZhbHNlLCAmcXVvdDtBZGQgaW5kZW50IHRvIEpTT04gcmVzcG9uc2UmcXVvdDspCgkJYy5GbGFncygpLlN0cmluZyhGbGFnRnJvbSwgJnF1b3Q7JnF1b3Q7LCAmcXVvdDtOYW1lIG9yIGFkZHJlc3Mgb2YgcHJpdmF0ZSBrZXkgd2l0aCB3aGljaCB0byBzaWduJnF1b3Q7KQoJCWMuRmxhZ3MoKS5VaW50NjRQKEZsYWdBY2NvdW50TnVtYmVyLCAmcXVvdDthJnF1b3Q7LCAwLCAmcXVvdDtUaGUgYWNjb3VudCBudW1iZXIgb2YgdGhlIHNpZ25pbmcgYWNjb3VudCAob2ZmbGluZSBtb2RlIG9ubHkpJnF1b3Q7KQoJCWMuRmxhZ3MoKS5VaW50NjRQKEZsYWdTZXF1ZW5jZSwgJnF1b3Q7cyZxdW90OywgMCwgJnF1b3Q7VGhlIHNlcXVlbmNlIG51bWJlciBvZiB0aGUgc2lnbmluZyBhY2NvdW50IChvZmZsaW5lIG1vZGUgb25seSkmcXVvdDspCgkJYy5GbGFncygpLlN0cmluZyhGbGFnTWVtbywgJnF1b3Q7JnF1b3Q7LCAmcXVvdDtNZW1vIHRvIHNlbmQgYWxvbmcgd2l0aCB0cmFuc2FjdGlvbiZxdW90OykKCQljLkZsYWdzKCkuU3RyaW5nKEZsYWdGZWVzLCAmcXVvdDsmcXVvdDssICZxdW90O0ZlZXMgdG8gcGF5IGFsb25nIHdpdGggdHJhbnNhY3Rpb247IGVnOiAxMHVhdG9tJnF1b3Q7KQoJCWMuRmxhZ3MoKS5TdHJpbmcoRmxhZ0dhc1ByaWNlcywgJnF1b3Q7JnF1b3Q7LCAmcXVvdDtHYXMgcHJpY2VzIHRvIGRldGVybWluZSB0aGUgdHJhbnNhY3Rpb24gZmVlIChlLmcuIDEwdWF0b20pJnF1b3Q7KQoJCWMuRmxhZ3MoKS5TdHJpbmcoRmxhZ05vZGUsICZxdW90O3RjcDovL2xvY2FsaG9zdDoyNjY1NyZxdW90OywgJnF1b3Q7Jmx0O2hvc3QmZ3Q7OiZsdDtwb3J0Jmd0OyB0byB0ZW5kZXJtaW50IHJwYyBpbnRlcmZhY2UgZm9yIHRoaXMgY2hhaW4mcXVvdDspCgkJYy5GbGFncygpLkJvb2woRmxhZ1VzZUxlZGdlciwgZmFsc2UsICZxdW90O1VzZSBhIGNvbm5lY3RlZCBMZWRnZXIgZGV2aWNlJnF1b3Q7KQoJCWMuRmxhZ3MoKS5GbG9hdDY0KEZsYWdHYXNBZGp1c3RtZW50LCBEZWZhdWx0R2FzQWRqdXN0bWVudCwgJnF1b3Q7YWRqdXN0bWVudCBmYWN0b3IgdG8gYmUgbXVsdGlwbGllZCBhZ2FpbnN0IHRoZSBlc3RpbWF0ZSByZXR1cm5lZCBieSB0aGUgdHggc2ltdWxhdGlvbjsgaWYgdGhlIGdhcyBsaW1pdCBpcyBzZXQgbWFudWFsbHkgdGhpcyBmbGFnIGlzIGlnbm9yZWQgJnF1b3Q7KQoJCWMuRmxhZ3MoKS5TdHJpbmdQKEZsYWdCcm9hZGNhc3RNb2RlLCAmcXVvdDtiJnF1b3Q7LCBCcm9hZGNhc3RTeW5jLCAmcXVvdDtUcmFuc2FjdGlvbiBicm9hZGNhc3RpbmcgbW9kZSAoc3luY3xhc3luY3xibG9jaykmcXVvdDspCgkJYy5GbGFncygpLkJvb2woRmxhZ1RydXN0Tm9kZSwgdHJ1ZSwgJnF1b3Q7VHJ1c3QgY29ubmVjdGVkIGZ1bGwgbm9kZSAoZG9uJ3QgdmVyaWZ5IHByb29mcyBmb3IgcmVzcG9uc2VzKSZxdW90OykKCQljLkZsYWdzKCkuQm9vbChGbGFnRHJ5UnVuLCBmYWxzZSwgJnF1b3Q7aWdub3JlIHRoZSAtLWdhcyBmbGFnIGFuZCBwZXJmb3JtIGEgc2ltdWxhdGlvbiBvZiBhIHRyYW5zYWN0aW9uLCBidXQgZG9uJ3QgYnJvYWRjYXN0IGl0JnF1b3Q7KQoJCWMuRmxhZ3MoKS5Cb29sKEZsYWdHZW5lcmF0ZU9ubHksIGZhbHNlLCAmcXVvdDtCdWlsZCBhbiB1bnNpZ25lZCB0cmFuc2FjdGlvbiBhbmQgd3JpdGUgaXQgdG8gU1RET1VUICh3aGVuIGVuYWJsZWQsIHRoZSBsb2NhbCBLZXliYXNlIGlzIG5vdCBhY2Nlc3NpYmxlIGFuZCB0aGUgbm9kZSBvcGVyYXRlcyBvZmZsaW5lKSZxdW90OykKCQljLkZsYWdzKCkuQm9vbFAoRmxhZ1NraXBDb25maXJtYXRpb24sICZxdW90O3kmcXVvdDssIGZhbHNlLCAmcXVvdDtTa2lwIHR4IGJyb2FkY2FzdGluZyBwcm9tcHQgY29uZmlybWF0aW9uJnF1b3Q7KQoKCQkvLyAtLWdhcyBjYW4gYWNjZXB0IGludGVnZXJzIGFuZCAmcXVvdDtzaW11bGF0ZSZxdW90OwoJCWMuRmxhZ3MoKS5WYXIoJmFtcDtHYXNGbGFnVmFyLCAmcXVvdDtnYXMmcXVvdDssIGZtdC5TcHJpbnRmKAoJCQkmcXVvdDtnYXMgbGltaXQgdG8gc2V0IHBlci10cmFuc2FjdGlvbjsgc2V0IHRvICVxIHRvIGNhbGN1bGF0ZSByZXF1aXJlZCBnYXMgYXV0b21hdGljYWxseSAoZGVmYXVsdCAlZCkmcXVvdDssCgkJCUdhc0ZsYWdBdXRvLCBEZWZhdWx0R2FzTGltaXQsCgkJKSkKCgkJdmlwZXIuQmluZFBGbGFnKEZsYWdUcnVzdE5vZGUsIGMuRmxhZ3MoKS5Mb29rdXAoRmxhZ1RydXN0Tm9kZSkpCgkJdmlwZXIuQmluZFBGbGFnKEZsYWdVc2VMZWRnZXIsIGMuRmxhZ3MoKS5Mb29rdXAoRmxhZ1VzZUxlZGdlcikpCgkJdmlwZXIuQmluZFBGbGFnKEZsYWdOb2RlLCBjLkZsYWdzKCkuTG9va3VwKEZsYWdOb2RlKSkKCgkJYy5NYXJrRmxhZ1JlcXVpcmVkKEZsYWdDaGFpbklEKQoJfQoJcmV0dXJuIGNtZHMKfQ=="}})],1),e._v(" "),o("p",[e._v("Here is an example of how to add a flag using the "),o("code",[e._v("from")]),e._v(" flag from this function.")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y21kLkZsYWdzKCkuU3RyaW5nKEZsYWdGcm9tLCAmcXVvdDsmcXVvdDssICZxdW90O05hbWUgb3IgYWRkcmVzcyBvZiBwcml2YXRlIGtleSB3aXRoIHdoaWNoIHRvIHNpZ24mcXVvdDspCg=="}}),e._v(" "),o("p",[e._v("The input provided for this flag - called "),o("code",[e._v("FlagFrom")]),e._v(" is a string with the default value of "),o("code",[e._v('""')]),e._v(" if none is provided. If the user asks for a description of this flag, the description will be printed.")]),e._v(" "),o("p",[e._v("A flag can be marked as "),o("em",[e._v("required")]),e._v(" so that an error is automatically thrown if the user does not provide a value:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y21kLk1hcmtGbGFnUmVxdWlyZWQoRmxhZ0Zyb20pCg=="}}),e._v(" "),o("p",[e._v("Since "),o("code",[e._v("PostCommands()")]),e._v(" includes all of the basic flags required for a transaction command, module developers may choose not to add any of their own (specifying arguments instead may often be more appropriate). For a full list of what flags are included in the "),o("code",[e._v("PostCommands()")]),e._v(" function, including which are required inputs from users, see the CLI documentation "),o("RouterLink",{attrs:{to:"/interfaces/cli.html#transaction-flags"}},[e._v("here")]),e._v(".")],1),e._v(" "),o("h2",{attrs:{id:"rest"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#rest"}},[e._v("#")]),e._v(" REST")]),e._v(" "),o("p",[e._v("Applications typically support web services that use HTTP requests (e.g. a web wallet like "),o("a",{attrs:{href:"https://lunie.io",target:"_blank",rel:"noopener noreferrer"}},[e._v("Lunie.io"),o("OutboundLink")],1),e._v(". Thus, application developers will also use REST Routes to route HTTP requests to the application's modules; these routes will be used by service providers. The module developer's responsibility is to define the REST client by defining "),o("a",{attrs:{href:"#register-routes"}},[e._v("routes")]),e._v(" for all possible "),o("a",{attrs:{href:"#request-types"}},[e._v("requests")]),e._v(" and "),o("a",{attrs:{href:"#request-handlers"}},[e._v("handlers")]),e._v(" for each of them. It's up to the module developer how to organize the REST interface files; there is typically a "),o("code",[e._v("rest.go")]),e._v(" file found in the module's "),o("code",[e._v("./x/moduleName/client/rest")]),e._v(" folder.")]),e._v(" "),o("p",[e._v("To support HTTP requests, the module developer needs to define possible request types, how to handle them, and provide a way to register them with a provided router.")]),e._v(" "),o("h3",{attrs:{id:"request-types"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#request-types"}},[e._v("#")]),e._v(" Request Types")]),e._v(" "),o("p",[e._v("Request types, which define structured interactions from users, must be defined for all "),o("em",[e._v("transaction")]),e._v(" requests. Users using this method to interact with an application will send HTTP Requests with the required fields in order to trigger state changes in the application. Conventionally, each request is named with the suffix "),o("code",[e._v("Req")]),e._v(", e.g. "),o("code",[e._v("SendReq")]),e._v(" for a Send transaction. Each struct should include a base request "),o("RouterLink",{attrs:{to:"/interfaces/rest.html#basereq"}},[o("code",[e._v("baseReq")])]),e._v(", the name of the transaction, and all the arguments the user must provide for the transaction.")],1),e._v(" "),o("p",[e._v("Here is an example of a request to buy a name from the "),o("code",[e._v("nameservice")]),e._v(" module:")]),e._v(" "),o("p",[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gU2VuZFJlcSBkZWZpbmVzIHRoZSBwcm9wZXJ0aWVzIG9mIGEgc2VuZCByZXF1ZXN0J3MgYm9keS4KdHlwZSBTZW5kUmVxIHN0cnVjdCB7CglCYXNlUmVxIHJlc3QuQmFzZVJlcSBganNvbjomcXVvdDtiYXNlX3JlcSZxdW90OyB5YW1sOiZxdW90O2Jhc2VfcmVxJnF1b3Q7YAoJQW1vdW50ICBzZGsuQ29pbnMgICAgYGpzb246JnF1b3Q7YW1vdW50JnF1b3Q7IHlhbWw6JnF1b3Q7YW1vdW50JnF1b3Q7YAp9"}})],1),e._v(" "),o("p",[e._v("The "),o("code",[e._v("BaseReq")]),e._v(" includes basic information that every request needs to have, similar to required flags in a CLI. All of these values, including "),o("code",[e._v("GasPrices")]),e._v(" and "),o("code",[e._v("AccountNumber")]),e._v(", will be provided in the request body. The user will also need to specify the arguments "),o("code",[e._v("Name")]),e._v(" and "),o("code",[e._v("Amount")]),e._v(" fields in the body and "),o("code",[e._v("Buyer")]),e._v(" will be provided by the user's address.")]),e._v(" "),o("h4",{attrs:{id:"basereq"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#basereq"}},[e._v("#")]),e._v(" BaseReq")]),e._v(" "),o("p",[o("code",[e._v("BaseReq")]),e._v(" is a type defined in the SDK that encapsulates much of the transaction configurations similar to CLI command flags. Users must provide the information in the body of their requests.")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("From")]),e._v(" indicates which "),o("RouterLink",{attrs:{to:"/basics/accounts.html"}},[e._v("account")]),e._v(" the transaction originates from. This account is used to sign the transaction.")],1),e._v(" "),o("li",[o("code",[e._v("Memo")]),e._v(" sends a memo along with the transaction.")]),e._v(" "),o("li",[o("code",[e._v("ChainID")]),e._v(" specifies the unique identifier of the blockchain the transaction pertains to.")]),e._v(" "),o("li",[o("code",[e._v("AccountNumber")]),e._v(" is an identifier for the account.")]),e._v(" "),o("li",[o("code",[e._v("Sequence")]),e._v("is the value of a counter measuring how many transactions have been sent from the account. It is used to prevent replay attacks.")]),e._v(" "),o("li",[o("code",[e._v("Gas")]),e._v(" refers to how much "),o("RouterLink",{attrs:{to:"/basics/gas-fees.html"}},[e._v("gas")]),e._v(", which represents computational resources, Tx consumes. Gas is dependent on the transaction and is not precisely calculated until execution, but can be estimated by providing auto as the value for "),o("code",[e._v("Gas")]),e._v(".")],1),e._v(" "),o("li",[o("code",[e._v("GasAdjustment")]),e._v(" can be used to scale gas up in order to avoid underestimating. For example, users can specify their gas adjustment as 1.5 to use 1.5 times the estimated gas.")]),e._v(" "),o("li",[o("code",[e._v("GasPrices")]),e._v(" specifies how much the user is willing pay per unit of gas, which can be one or multiple denominations of tokens. For example, --gas-prices=0.025uatom, 0.025upho means the user is willing to pay 0.025uatom AND 0.025upho per unit of gas.")]),e._v(" "),o("li",[o("code",[e._v("Fees")]),e._v(" specifies how much in "),o("RouterLink",{attrs:{to:"/basics/gas-fees.html"}},[e._v("fees")]),e._v(" the user is willing to pay in total. Note that the user only needs to provide either "),o("code",[e._v("gas-prices")]),e._v(" or "),o("code",[e._v("fees")]),e._v(", but not both, because they can be derived from each other.")],1),e._v(" "),o("li",[o("code",[e._v("Simulate")]),e._v(" instructs the application to ignore gas and simulate the transaction running without broadcasting.")])]),e._v(" "),o("h3",{attrs:{id:"request-handlers"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#request-handlers"}},[e._v("#")]),e._v(" Request Handlers")]),e._v(" "),o("p",[e._v("Request handlers must be defined for both transaction and query requests. Handlers' arguments include a reference to the application's "),o("code",[e._v("codec")]),e._v(" and the "),o("RouterLink",{attrs:{to:"/interfaces/query-lifecycle.html#clicontext"}},[o("code",[e._v("CLIContext")])]),e._v(" created in the user interaction.")],1),e._v(" "),o("p",[e._v("Here is an example of a request handler for the nameservice module "),o("code",[e._v("buyNameReq")]),e._v(" request (the same one shown above):")]),e._v(" "),o("p",[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gTmV3U2VuZFJlcXVlc3RIYW5kbGVyRm4gcmV0dXJucyBhbiBIVFRQIFJFU1QgaGFuZGxlciBmb3IgY3JlYXRpbmcgYSBNc2dTZW5kCi8vIHRyYW5zYWN0aW9uLgpmdW5jIE5ld1NlbmRSZXF1ZXN0SGFuZGxlckZuKGNsaWVudEN0eCBjbGllbnQuQ29udGV4dCkgaHR0cC5IYW5kbGVyRnVuYyB7CglyZXR1cm4gZnVuYyh3IGh0dHAuUmVzcG9uc2VXcml0ZXIsIHIgKmh0dHAuUmVxdWVzdCkgewoJCXZhcnMgOj0gbXV4LlZhcnMocikKCQliZWNoMzJBZGRyIDo9IHZhcnNbJnF1b3Q7YWRkcmVzcyZxdW90O10KCgkJdG9BZGRyLCBlcnIgOj0gc2RrLkFjY0FkZHJlc3NGcm9tQmVjaDMyKGJlY2gzMkFkZHIpCgkJaWYgcmVzdC5DaGVja0JhZFJlcXVlc3RFcnJvcih3LCBlcnIpIHsKCQkJcmV0dXJuCgkJfQoKCQl2YXIgcmVxIFNlbmRSZXEKCQlpZiAhcmVzdC5SZWFkUkVTVFJlcSh3LCByLCBjbGllbnRDdHguTGVnYWN5QW1pbm8sICZhbXA7cmVxKSB7CgkJCXJldHVybgoJCX0KCgkJcmVxLkJhc2VSZXEgPSByZXEuQmFzZVJlcS5TYW5pdGl6ZSgpCgkJaWYgIXJlcS5CYXNlUmVxLlZhbGlkYXRlQmFzaWModykgewoJCQlyZXR1cm4KCQl9CgoJCWZyb21BZGRyLCBlcnIgOj0gc2RrLkFjY0FkZHJlc3NGcm9tQmVjaDMyKHJlcS5CYXNlUmVxLkZyb20pCgkJaWYgcmVzdC5DaGVja0JhZFJlcXVlc3RFcnJvcih3LCBlcnIpIHsKCQkJcmV0dXJuCgkJfQoKCQltc2cgOj0gdHlwZXMuTmV3TXNnU2VuZChmcm9tQWRkciwgdG9BZGRyLCByZXEuQW1vdW50KQoJCXR4LldyaXRlR2VuZXJhdGVkVHhSZXNwb25zZShjbGllbnRDdHgsIHcsIHJlcS5CYXNlUmVxLCBtc2cpCgl9Cn0="}})],1),e._v(" "),o("p",[e._v("The request handler can be broken down as follows:")]),e._v(" "),o("ul",[o("li",[o("strong",[e._v("Parse Request:")]),e._v(" The request handler first attempts to parse the request, and then run "),o("code",[e._v("Sanitize")]),e._v(" and "),o("code",[e._v("ValidateBasic")]),e._v(" on the underlying "),o("code",[e._v("BaseReq")]),e._v(" to check the validity of the request. Next, it attempts to parse the arguments "),o("code",[e._v("Buyer")]),e._v(" and "),o("code",[e._v("Amount")]),e._v(" to the types "),o("code",[e._v("AccountAddress")]),e._v(" and "),o("code",[e._v("Coins")]),e._v(" respectively.")]),e._v(" "),o("li",[o("strong",[e._v("Message:")]),e._v(" Then, a "),o("RouterLink",{attrs:{to:"/building-modules/messages-and-queries.html"}},[e._v("message")]),e._v(" of the type "),o("code",[e._v("MsgBuyName")]),e._v(" (defined by the module developer to trigger the state changes for this transaction) is created from the values and another sanity check, "),o("code",[e._v("ValidateBasic")]),e._v(" is run on it.")],1),e._v(" "),o("li",[o("strong",[e._v("Generate Transaction:")]),e._v(" Finally, the HTTP "),o("code",[e._v("ResponseWriter")]),e._v(", application "),o("RouterLink",{attrs:{to:"/core/encoding.html"}},[o("code",[e._v("codec")])]),e._v(", "),o("RouterLink",{attrs:{to:"/interfaces/query-lifecycle.html#clicontext"}},[o("code",[e._v("CLIContext")])]),e._v(", request "),o("RouterLink",{attrs:{to:"/interfaces/rest.html#basereq"}},[o("code",[e._v("BaseReq")])]),e._v(", and message is passed to "),o("code",[e._v("WriteGenerateStdTxResponse")]),e._v(" to further process the request.")],1)]),e._v(" "),o("p",[e._v("To read more about how a transaction is generated, visit the transactions documentation "),o("RouterLink",{attrs:{to:"/core/transactions.html#transaction-generation"}},[e._v("here")]),e._v(".")],1),e._v(" "),o("h3",{attrs:{id:"register-routes"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#register-routes"}},[e._v("#")]),e._v(" Register Routes")]),e._v(" "),o("p",[e._v("The application CLI entrypoint will have a "),o("code",[e._v("RegisterRoutes")]),e._v(" function in its "),o("code",[e._v("main.go")]),e._v(" file, which calls the "),o("code",[e._v("registerRoutes")]),e._v(" functions of each module utilized by the application. Module developers need to implement "),o("code",[e._v("registerRoutes")]),e._v(" for their modules so that applications are able to route messages and queries to their corresponding handlers and queriers.")]),e._v(" "),o("p",[e._v("The router used by the SDK is "),o("a",{attrs:{href:"https://github.com/gorilla/mux",target:"_blank",rel:"noopener noreferrer"}},[e._v("Gorilla Mux"),o("OutboundLink")],1),e._v(". The router is initialized with the Gorilla Mux "),o("code",[e._v("NewRouter()")]),e._v(" function. Then, the router's "),o("code",[e._v("HandleFunc")]),e._v(' function can then be used to route urls with the defined request handlers and the HTTP method (e.g. "POST", "GET") as a route matcher. It is recommended to prefix every route with the name of the module to avoid collisions with other modules that have the same query or transaction names.')]),e._v(" "),o("p",[e._v("Here is a "),o("code",[e._v("registerRoutes")]),e._v(" function with one query route example from the "),o("a",{attrs:{href:"https://cosmos.network/docs/tutorial/rest.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("nameservice tutorial"),o("OutboundLink")],1),e._v(":")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:" go",base64:"ZnVuYyBSZWdpc3RlclJvdXRlcyhjbGlDdHggY29udGV4dC5DTElDb250ZXh0LCByICptdXguUm91dGVyLCBjZGMgKmNvZGVjLkNvZGVjLCBzdG9yZU5hbWUgc3RyaW5nKSB7CiAgLy8gUmVzb2x2ZU5hbWUgUXVlcnkKICByLkhhbmRsZUZ1bmMoZm10LlNwcmludGYoJnF1b3Q7LyVzL25hbWVzL3slc30mcXVvdDssIHN0b3JlTmFtZSwgcmVzdE5hbWUpLCByZXNvbHZlTmFtZUhhbmRsZXIoY2RjLCBjbGlDdHgsIHN0b3JlTmFtZSkpLk1ldGhvZHMoJnF1b3Q7R0VUJnF1b3Q7KQp9Cg=="}}),e._v(" "),o("p",[e._v("A few things to note:")]),e._v(" "),o("ul",[o("li",[e._v("The router "),o("code",[e._v("r")]),e._v(" has already been initialized by the application and is passed in here as an argument - this function is able to add on the nameservice module's routes onto any application's router. The application must also provide a "),o("RouterLink",{attrs:{to:"/interfaces/query-lifecycle.html#clicontext"}},[o("code",[e._v("CLIContext")])]),e._v(" that the querier will need to process user requests and the application "),o("RouterLink",{attrs:{to:"/core/encoding.html"}},[o("code",[e._v("codec")])]),e._v(" for encoding and decoding application-specific types.")],1),e._v(" "),o("li",[o("code",[e._v('"/%s/names/{%s}", storeName, restName')]),e._v(" is the url for the HTTP request. "),o("code",[e._v("storeName")]),e._v(" is the name of the module, "),o("code",[e._v("restName")]),e._v(" is a variable provided by the user to specify what kind of query they are making.")]),e._v(" "),o("li",[o("code",[e._v("resolveNameHandler")]),e._v(" is the query request handler defined by the module developer. It also takes the application "),o("code",[e._v("codec")]),e._v(" and "),o("code",[e._v("CLIContext")]),e._v(" passed in from the user side, as well as the "),o("code",[e._v("storeName")]),e._v(".")]),e._v(" "),o("li",[o("code",[e._v('"GET"')]),e._v(" is the HTTP Request method. As to be expected, queries are typically GET requests. Transactions are typically POST and PUT requests.")])]),e._v(" "),o("h2",{attrs:{hide:"",id:"next"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#next"}},[e._v("#")]),e._v(" Next")]),e._v(" "),o("p",{attrs:{hide:""}},[e._v("Read about the recommended "),o("RouterLink",{attrs:{to:"/building-modules/structure.html"}},[e._v("module structure")])],1)],1)}),[],!1,null,null,null);t.default=s.exports}}]);