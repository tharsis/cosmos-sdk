(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{849:function(g,C,t){"use strict";t.r(C);var I=t(1),A=Object(I.a)({},(function(){var g=this,C=g.$createElement,t=g._self._c||C;return t("ContentSlotsDistributor",{attrs:{"slot-key":g.$parent.slotKey}},[t("h1",{attrs:{id:"sdk-应用程序架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sdk-应用程序架构"}},[g._v("#")]),g._v(" SDK 应用程序架构")]),g._v(" "),t("h2",{attrs:{id:"状态机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#状态机"}},[g._v("#")]),g._v(" 状态机")]),g._v(" "),t("p",[g._v("区块链应用的核心是"),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/State_machine_replication",target:"_blank",rel:"noopener noreferrer"}},[g._v("具有最终确定性的复制状态机"),t("OutboundLink")],1),g._v("。")]),g._v(" "),t("p",[g._v("状态机是计算机科学概念，一台机器可以具有多个状态，但在任何给定时间只有一个"),t("code",[g._v("状态")]),g._v("，其描述了系统的当前状态，及触发这些状态转变的交易（译者注：也对应数据库中事务的概念）。")]),g._v(" "),t("p",[g._v("给定一个状态S和交易T，状态机会返回一个新的状态S'。")]),g._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Ky0tLS0tLS0tKyAgICAgICAgICAgICAgICAgKy0tLS0tLS0tKwp8ICAgICAgICB8ICAgICAgICAgICAgICAgICB8ICAgICAgICB8CnwgICBTICAgICstLS0tLS0tLS0tLS0tLS0tJmd0OysgICBTJyAgIHwKfCAgICAgICAgfCAgICBhcHBseShUKSAgICAgfCAgICAgICAgfAorLS0tLS0tLS0rICAgICAgICAgICAgICAgICArLS0tLS0tLS0rCg=="}}),g._v(" "),t("p",[g._v("实际上，交易以区块的形式打包在一起以提高过程的效率。给定状态S和包含交易的区块B，状态机将返回新状态S'。")]),g._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Ky0tLS0tLS0tKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICstLS0tLS0tLSsKfCAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgIHwKfCAgIFMgICAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0mZ3Q7IHwgICBTJyAgIHwKfCAgICAgICAgfCAgIEZvciBlYWNoIFQgaW4gQjogYXBwbHkoVCkgIHwgICAgICAgIHwKKy0tLS0tLS0tKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICstLS0tLS0tLSsK"}}),g._v(" "),t("p",[g._v("在区块链上下文环境中，状态机是确定性的。这意味着如果你从一个给定的状态开始，重放相同顺序的交易，将始终以相同的最终状态结束。")]),g._v(" "),t("p",[g._v("Cosmos SDK 为你提供了最大的灵活性用以定义自身应用程序的状态、交易类型和状态转换函数。在接下来的章节中会更深入细致的描述如何使用 SDK 来构建状态机。但首先，让我们看看状态机是如何使用 "),t("strong",[g._v("Tendermint")]),g._v(" 进行复制的。")]),g._v(" "),t("h3",{attrs:{id:"tendermint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tendermint"}},[g._v("#")]),g._v(" Tendermint")]),g._v(" "),t("p",[g._v("作为一个开发者，你只需要使用 Cosmos-SDK 定义状态机，而"),t("a",{attrs:{href:"https://tendermint.com/docs/introduction/introduction.html",target:"_blank",rel:"noopener noreferrer"}},[g._v("Tendermint"),t("OutboundLink")],1),g._v("将会为你处理网络层的状态复制。")]),g._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ICAgICAgICAgICAgICAgIF4gICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKyAgXgogICAgICAgICAgICAgICAgfCAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICB8ICAg6YCa6L+HIENvc21vcyBTREsg5p6E5bu6CiAgICAgICAgICAgICAgICB8ICB8ICAgICAgICAg54q25oCB5py6ID0g5bqU55So77yI5bGC77yJICAgICAgfCAgfAogICAgICAgICAgICAgICAgfCAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICB2CiAgICAgICAgICAgICAgICB8ICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSsKICAgICAgICAgICAgICAgIHwgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgXgogICAgICAg6ZO+6IqC54K5ICAgIHwgIHwgICAgICAgICAgICAg5YWx6K+G5bGCICAgICAgICAgICAgIHwgIHwKICAgICAgICAgICAgICAgIHwgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgfAogICAgICAgICAgICAgICAgfCAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICB8ICAgVGVuZGVybWludCBDb3JlCiAgICAgICAgICAgICAgICB8ICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgIHwKICAgICAgICAgICAgICAgIHwgIHwgICAgICAgICAgICAgIOe9kee7nOWxgiAgICAgICAgICAgIHwgIHwKICAgICAgICAgICAgICAgIHwgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgfAogICAgICAgICAgICAgICAgdiAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICB2Cg=="}}),g._v(" "),t("p",[g._v("Tendermint是一个与应用程序无关的引擎，负责处理区块链的"),t("em",[g._v("网络层")]),g._v("和"),t("em",[g._v("共识层")]),g._v("。实际上，这意味着Tendermint负责传播和排序交易字节。Tendermint Core 依赖于拜占庭容错（BFT）算法来达成交易顺序的共识。要深入了解Tendermint，可点击"),t("a",{attrs:{href:"https://tendermint.com/docs/introduction/what-is-tendermint.html",target:"_blank",rel:"noopener noreferrer"}},[g._v("这里"),t("OutboundLink")],1),g._v("。")]),g._v(" "),t("p",[g._v("Tendermint一致性算法通过一组称为"),t("em",[g._v("验证人")]),g._v("的特殊节点一起运作。验证人负责向区块链添加交易区块。对于任何给定的区块，有一组验证人V。通过算法选择V中的验证人A作为下一个区块的提议人。如果超过三分之二的V签署了"),t("a",{attrs:{href:"https://tendermint.com/docs/spec/consensus/consensus.html#state-machine-spec",target:"_blank",rel:"noopener noreferrer"}},[g._v("prevote"),t("OutboundLink")],1),g._v("和"),t("a",{attrs:{href:"https://tendermint.com/docs/spec/consensus/consensus.html#state-machine-spec",target:"_blank",rel:"noopener noreferrer"}},[g._v("precommit"),t("OutboundLink")],1),g._v("，并且区块包含的所有交易都是有效的，则该区块被认为是有效的。验证人集合可以通过状态机中编写的规则进行更改。要深入了解算法，"),t("a",{attrs:{href:"https://tendermint.com/docs/introduction/what-is-tendermint.html#consensus-overview",target:"_blank",rel:"noopener noreferrer"}},[g._v("点击"),t("OutboundLink")],1),g._v("。")]),g._v(" "),t("p",[g._v("Cosmos SDK 应用程序的主要部分是一个区块链服务后台（daemon），它在每个网络节点的本地运行。如果验证人集合中三分之一以下的是拜占庭（即恶意的），则每个节点在同时查询状态时应获得相同的结果。")]),g._v(" "),t("h2",{attrs:{id:"abci"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#abci"}},[g._v("#")]),g._v(" ABCI")]),g._v(" "),t("p",[g._v("Tendermint通过名为"),t("a",{attrs:{href:"https://github.com/tendermint/tendermint/tree/master/abci",target:"_blank",rel:"noopener noreferrer"}},[g._v("ABCI"),t("OutboundLink")],1),g._v("的接口将交易从网络层传递给应用程序，因此应用程序必须要实现 ABCI 。")]),g._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Ky0tLS0tLS0tLS0tLS0tLS0tLS0tLSsKfCAgICAgICAgICAgICAgICAgICAgIHwKfCAgICAgICAgIOW6lOeUqCAgICAgICAgIHwKfCAgICAgICAgICAgICAgICAgICAgIHwKKy0tLS0tLS0tKy0tLSstLS0tLS0tLSsKICAgICAgICAgXiAgIHwKICAgICAgICAgfCAgIHwgQUJDSQogICAgICAgICB8ICAgdgorLS0tLS0tLS0rLS0tKy0tLS0tLS0tKwp8ICAgICAgICAgICAgICAgICAgICAgfAp8ICAgICAgICAgICAgICAgICAgICAgfAp8ICAgICBUZW5kZXJtaW50ICAgICAgfAp8ICAgICAgICAgICAgICAgICAgICAgfAp8ICAgICAgICAgICAgICAgICAgICAgfAorLS0tLS0tLS0tLS0tLS0tLS0tLS0tKwo="}}),g._v(" "),t("p",[g._v("注意，Tendermint 仅处理交易字节。它不知道这些字节究竟是什么意思。Tendermint 所做的只是对交易确定性地排序。赋予这些字节意义是应用程序的工作。Tendermint通过ABCI将交易字节传递给应用程序，并期望返回代码以知晓消息是否成功。")]),g._v(" "),t("p",[g._v("以下是ABCI中最重要的消息类型：")]),g._v(" "),t("ul",[t("li",[t("code",[g._v("CheckTx")]),g._v(" : 当 Tendermint Core 收到交易时，如果符合一些的基本的要求会将其传递给应用程序。"),t("code",[g._v("Checkx")]),g._v(" 用于保护全节点的交易池免受垃圾邮件的侵害。一个名为“Ante Handler”的特殊处理器用于执行一系列验证步骤，例如检查手续费用是否足够和验证签名是否合法。如果交易有效，则将交易添加到"),t("a",{attrs:{href:"https://tendermint.com/docs/spec/reactors/mempool/functionality.html#mempool-functionality",target:"_blank",rel:"noopener noreferrer"}},[g._v("交易池（mempool）"),t("OutboundLink")],1),g._v("中并广播到对等节点。注意， "),t("code",[g._v("CheckTx")]),g._v(" 不会处理交易（即不会对修改状态），因为它们尚未包含在区块中。")]),g._v(" "),t("li",[t("code",[g._v("DeliverTx")]),g._v(" : 当 Tendermint Core 接收到"),t("a",{attrs:{href:"https://tendermint.com/docs/spec/blockchain/blockchain.html#validation",target:"_blank",rel:"noopener noreferrer"}},[g._v("有效区块"),t("OutboundLink")],1),g._v("时，块中的每条交易都将通过 "),t("code",[g._v("DeliverTx")]),g._v("传递给应用程序进行处理。正是在这一阶段发生了状态转换。“Ante Handler”也将连同实际处理交易中每条消息的handler一起再次执行。")]),g._v(" "),t("li",[t("code",[g._v("BeginBlock")]),g._v("/"),t("code",[g._v("EndBlock")]),g._v(" : 无论区块是否包含交易，这两个消息都将在每个区块的开头和结尾执行。触发自动的逻辑执行是很有用的。过程中要足够小心，因为计算成本高昂的循环运算可能会减慢区块链的速度，甚至发生无限循环引起区块链本身停滞。")])]),g._v(" "),t("p",[g._v("有关 ABCI 方法和类型的详细介绍请"),t("a",{attrs:{href:"https://tendermint.com/docs/spec/abci/abci.html#overview",target:"_blank",rel:"noopener noreferrer"}},[g._v("点击"),t("OutboundLink")],1),g._v("。")]),g._v(" "),t("p",[g._v("在 Tendermint 上构建的任何应用程序都需要实现ABCI接口，来同本地的底层 Tendermint 引擎进行通信。幸运的是，你不用必需实现ABCI接口。Cosmos SDK以"),t("RouterLink",{attrs:{to:"/cn/intro/sdk-design.html#baseapp"}},[g._v("baseapp")]),g._v("的形式提供了样板实现。")],1),g._v(" "),t("h3",{attrs:{id:"接下来-让我们学习sdk的高级设计原则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#接下来-让我们学习sdk的高级设计原则"}},[g._v("#")]),g._v(" 接下来，让我们学习"),t("RouterLink",{attrs:{to:"/cn/intro/sdk-design.html"}},[g._v("SDK的高级设计原则")])],1)],1)}),[],!1,null,null,null);C.default=A.exports}}]);