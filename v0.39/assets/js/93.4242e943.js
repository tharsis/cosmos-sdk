(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{869:function(e,t,o){"use strict";o.r(t);var s=o(1),a=Object(s.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"messages-and-queries"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#messages-and-queries"}},[e._v("#")]),e._v(" Messages and Queries")]),e._v(" "),o("h2",{attrs:{hide:"",id:"pre-requisite-readings"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#pre-requisite-readings"}},[e._v("#")]),e._v(" Pre-requisite Readings")]),e._v(" "),o("ul",[o("li",{attrs:{prereq:""}},[o("RouterLink",{attrs:{to:"/building-modules/intro.html"}},[e._v("Introduction to SDK Modules")])],1)]),e._v(" "),o("h2",{attrs:{id:"messages"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#messages"}},[e._v("#")]),e._v(" Messages")]),e._v(" "),o("p",[o("code",[e._v("Message")]),e._v("s are objects whose end-goal is to trigger state-transitions. They are wrapped in "),o("RouterLink",{attrs:{to:"/core/transactions.html"}},[e._v("transactions")]),e._v(", which may contain one or multiple of them.")],1),e._v(" "),o("p",[e._v("When a transaction is relayed from the underlying consensus engine to the SDK application, it is first decoded by "),o("RouterLink",{attrs:{to:"/core/baseapp.html"}},[o("code",[e._v("baseapp")])]),e._v(". Then, each "),o("code",[e._v("message")]),e._v(" contained in the transaction is extracted and routed to the appropriate module via "),o("code",[e._v("baseapp")]),e._v("'s "),o("code",[e._v("router")]),e._v(" so that it can be processed by the module's "),o("RouterLink",{attrs:{to:"/building-modules/handler.html"}},[o("code",[e._v("handler")])]),e._v(". For a more detailed explanation of the lifecycle of a transaction, click "),o("RouterLink",{attrs:{to:"/basics/tx-lifecycle.html"}},[e._v("here")]),e._v(".")],1),e._v(" "),o("p",[e._v("Defining "),o("code",[e._v("message")]),e._v("s is the responsibility of module developers. Typically, they are defined in a "),o("code",[e._v("./internal/types/msgs.go")]),e._v(" file inside the module's folder. The "),o("code",[e._v("message")]),e._v("'s type definition usually includes a list of parameters needed to process the message that will be provided by end-users when they want to create a new transaction containing said "),o("code",[e._v("message")]),e._v(".")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gRXhhbXBsZSBvZiBhIG1lc3NhZ2UgdHlwZSBkZWZpbml0aW9uCgp0eXBlIE1zZ1N1Ym1pdFByb3Bvc2FsIHN0cnVjdCB7CglDb250ZW50ICAgICAgICBDb250ZW50ICAgICAgICBganNvbjomcXVvdDtjb250ZW50JnF1b3Q7IHlhbWw6JnF1b3Q7Y29udGVudCZxdW90O2AKCUluaXRpYWxEZXBvc2l0IHNkay5Db2lucyAgICAgIGBqc29uOiZxdW90O2luaXRpYWxfZGVwb3NpdCZxdW90OyB5YW1sOiZxdW90O2luaXRpYWxfZGVwb3NpdCZxdW90O2AgCglQcm9wb3NlciAgICAgICBzZGsuQWNjQWRkcmVzcyBganNvbjomcXVvdDtwcm9wb3NlciZxdW90OyB5YW1sOiZxdW90O3Byb3Bvc2VyJnF1b3Q7YCAgICAgICAgICAgICAgIAp9Cg=="}}),e._v(" "),o("p",[e._v("The "),o("code",[e._v("Msg")]),e._v(" is typically accompanied by a standard constructor function, that is called from one of the "),o("RouterLink",{attrs:{to:"/building-modules/module-interfaces.html"}},[e._v("module's interface")]),e._v(". "),o("code",[e._v("message")]),e._v("s also need to implement the ["),o("code",[e._v("Msg")]),e._v("] interface:")],1),e._v(" "),o("p",[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gVHJhbnNhY3Rpb25zIG1lc3NhZ2VzIG11c3QgZnVsZmlsbCB0aGUgTXNnCnR5cGUgTXNnIGludGVyZmFjZSB7CgoJLy8gUmV0dXJuIHRoZSBtZXNzYWdlIHR5cGUuCgkvLyBNdXN0IGJlIGFscGhhbnVtZXJpYyBvciBlbXB0eS4KCVJvdXRlKCkgc3RyaW5nCgoJLy8gUmV0dXJucyBhIGh1bWFuLXJlYWRhYmxlIHN0cmluZyBmb3IgdGhlIG1lc3NhZ2UsIGludGVuZGVkIGZvciB1dGlsaXphdGlvbgoJLy8gd2l0aGluIHRhZ3MKCVR5cGUoKSBzdHJpbmcKCgkvLyBWYWxpZGF0ZUJhc2ljIGRvZXMgYSBzaW1wbGUgdmFsaWRhdGlvbiBjaGVjayB0aGF0CgkvLyBkb2Vzbid0IHJlcXVpcmUgYWNjZXNzIHRvIGFueSBvdGhlciBpbmZvcm1hdGlvbi4KCVZhbGlkYXRlQmFzaWMoKSBFcnJvcgoKCS8vIEdldCB0aGUgY2Fub25pY2FsIGJ5dGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIE1zZy4KCUdldFNpZ25CeXRlcygpIFtdYnl0ZQoKCS8vIFNpZ25lcnMgcmV0dXJucyB0aGUgYWRkcnMgb2Ygc2lnbmVycyB0aGF0IG11c3Qgc2lnbi4KCS8vIENPTlRSQUNUOiBBbGwgc2lnbmF0dXJlcyBtdXN0IGJlIHByZXNlbnQgdG8gYmUgdmFsaWQuCgkvLyBDT05UUkFDVDogUmV0dXJucyBhZGRycyBpbiBzb21lIGRldGVybWluaXN0aWMgb3JkZXIuCglHZXRTaWduZXJzKCkgW11BY2NBZGRyZXNzCn0="}})],1),e._v(" "),o("p",[e._v("It contains the following methods:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("Route() string")]),e._v(": Name of the route for this message. Typically all "),o("code",[e._v("message")]),e._v("s in a module have the same route, which is most often the module's name.")]),e._v(" "),o("li",[o("code",[e._v("Type() string")]),e._v(": Type of the message, used primarly in "),o("RouterLink",{attrs:{to:"/core/events.html"}},[e._v("events")]),e._v(". This should return a message-specific "),o("code",[e._v("string")]),e._v(", typically the denomination of the message itself.")],1),e._v(" "),o("li",[o("code",[e._v("ValidateBasic() Error")]),e._v(": This method is called by "),o("code",[e._v("baseapp")]),e._v(" very early in the processing of the "),o("code",[e._v("message")]),e._v(" (in both "),o("RouterLink",{attrs:{to:"/core/baseapp.html#checktx"}},[o("code",[e._v("CheckTx")])]),e._v(" and "),o("RouterLink",{attrs:{to:"/core/baseapp.html#delivertx"}},[o("code",[e._v("DeliverTx")])]),e._v("), in order to discard obviously invalid messages. "),o("code",[e._v("ValidateBasic")]),e._v(" should only include "),o("em",[e._v("stateless")]),e._v(" checks, i.e. checks that do not require access to the state. This usually consists in checking that the message's parameters are correctly formatted and valid (i.e. that the "),o("code",[e._v("amount")]),e._v(" is strictly positive for a transfer).")],1),e._v(" "),o("li",[o("code",[e._v("GetSignBytes() []byte")]),e._v(": Return the canonical byte representation of the message. Used to generate a signature.")]),e._v(" "),o("li",[o("code",[e._v("GetSigners() []AccAddress")]),e._v(": Return the list of signers. The SDK will make sure that each "),o("code",[e._v("message")]),e._v(" contained in a transaction is signed by all the signers listed in the list returned by this method.")])]),e._v(" "),o("p",[e._v("See an example implementation of a "),o("code",[e._v("message")]),e._v(" from the "),o("code",[e._v("nameservice")]),e._v(" module:")]),e._v(" "),o("p",[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gTXNnU2V0TmFtZSBkZWZpbmVzIGEgU2V0TmFtZSBtZXNzYWdlCnR5cGUgTXNnU2V0TmFtZSBzdHJ1Y3QgewoJTmFtZSAgc3RyaW5nICAgICAgICAgYGpzb246JnF1b3Q7bmFtZSZxdW90O2AKCVZhbHVlIHN0cmluZyAgICAgICAgIGBqc29uOiZxdW90O3ZhbHVlJnF1b3Q7YAoJT3duZXIgc2RrLkFjY0FkZHJlc3MgYGpzb246JnF1b3Q7b3duZXImcXVvdDtgCn0KCi8vIE5ld01zZ1NldE5hbWUgaXMgYSBjb25zdHJ1Y3RvciBmdW5jdGlvbiBmb3IgTXNnU2V0TmFtZQpmdW5jIE5ld01zZ1NldE5hbWUobmFtZSBzdHJpbmcsIHZhbHVlIHN0cmluZywgb3duZXIgc2RrLkFjY0FkZHJlc3MpIE1zZ1NldE5hbWUgewoJcmV0dXJuIE1zZ1NldE5hbWV7CgkJTmFtZTogIG5hbWUsCgkJVmFsdWU6IHZhbHVlLAoJCU93bmVyOiBvd25lciwKCX0KfQoKLy8gUm91dGUgc2hvdWxkIHJldHVybiB0aGUgbmFtZSBvZiB0aGUgbW9kdWxlCmZ1bmMgKG1zZyBNc2dTZXROYW1lKSBSb3V0ZSgpIHN0cmluZyB7IHJldHVybiBSb3V0ZXJLZXkgfQoKLy8gVHlwZSBzaG91bGQgcmV0dXJuIHRoZSBhY3Rpb24KZnVuYyAobXNnIE1zZ1NldE5hbWUpIFR5cGUoKSBzdHJpbmcgeyByZXR1cm4gJnF1b3Q7c2V0X25hbWUmcXVvdDsgfQoKLy8gVmFsaWRhdGVCYXNpYyBydW5zIHN0YXRlbGVzcyBjaGVja3Mgb24gdGhlIG1lc3NhZ2UKZnVuYyAobXNnIE1zZ1NldE5hbWUpIFZhbGlkYXRlQmFzaWMoKSBzZGsuRXJyb3IgewoJaWYgbXNnLk93bmVyLkVtcHR5KCkgewoJCXJldHVybiBzZGsuRXJySW52YWxpZEFkZHJlc3MobXNnLk93bmVyLlN0cmluZygpKQoJfQoJaWYgbGVuKG1zZy5OYW1lKSA9PSAwIHx8IGxlbihtc2cuVmFsdWUpID09IDAgewoJCXJldHVybiBzZGsuRXJyVW5rbm93blJlcXVlc3QoJnF1b3Q7TmFtZSBhbmQvb3IgVmFsdWUgY2Fubm90IGJlIGVtcHR5JnF1b3Q7KQoJfQoJcmV0dXJuIG5pbAp9CgovLyBHZXRTaWduQnl0ZXMgZW5jb2RlcyB0aGUgbWVzc2FnZSBmb3Igc2lnbmluZwpmdW5jIChtc2cgTXNnU2V0TmFtZSkgR2V0U2lnbkJ5dGVzKCkgW11ieXRlIHsKCXJldHVybiBzZGsuTXVzdFNvcnRKU09OKE1vZHVsZUNkYy5NdXN0TWFyc2hhbEpTT04obXNnKSkKfQoKLy8gR2V0U2lnbmVycyBkZWZpbmVzIHdob3NlIHNpZ25hdHVyZSBpcyByZXF1aXJlZApmdW5jIChtc2cgTXNnU2V0TmFtZSkgR2V0U2lnbmVycygpIFtdc2RrLkFjY0FkZHJlc3MgewoJcmV0dXJuIFtdc2RrLkFjY0FkZHJlc3N7bXNnLk93bmVyfQp9"}})],1),e._v(" "),o("h2",{attrs:{id:"queries"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#queries"}},[e._v("#")]),e._v(" Queries")]),e._v(" "),o("p",[e._v("A "),o("code",[e._v("query")]),e._v(" is a request for information made by end-users of applications through an interface and processed by a full-node. A "),o("code",[e._v("query")]),e._v(" is received by a full-node through its consensus engine and relayed to the application via the ABCI. It is then routed to the appropriate module via "),o("code",[e._v("baseapp")]),e._v("'s "),o("code",[e._v("queryrouter")]),e._v(" so that it can be processed by the module's "),o("RouterLink",{attrs:{to:"/building-modules/querier.html"}},[o("code",[e._v("querier")])]),e._v(". For a deeper look at the lifecycle of a "),o("code",[e._v("query")]),e._v(", click "),o("RouterLink",{attrs:{to:"/interfaces/query-lifecycle.html"}},[e._v("here")]),e._v(".")],1),e._v(" "),o("p",[e._v("Contrary to "),o("code",[e._v("message")]),e._v("s, there is usually no specific "),o("code",[e._v("query")]),e._v(" object defined by module developers. Instead, the SDK takes the simpler approach of using a simple "),o("code",[e._v("path")]),e._v(" to define each "),o("code",[e._v("query")]),e._v(". The "),o("code",[e._v("path")]),e._v(" contains the "),o("code",[e._v("query")]),e._v(" type and all the arguments needed in order to process it. For most module queries, the "),o("code",[e._v("path")]),e._v(" should look like the following:")]),e._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"cXVlcnlDYXRlZ29yeS9xdWVyeVJvdXRlL3F1ZXJ5VHlwZS9hcmcxL2FyZzIvLi4uCg=="}}),e._v(" "),o("p",[e._v("where:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("queryCategory")]),e._v(" is the category of the "),o("code",[e._v("query")]),e._v(", typically "),o("code",[e._v("custom")]),e._v(" for module queries. It is used to differentiate between different kinds of queries within "),o("code",[e._v("baseapp")]),e._v("'s "),o("RouterLink",{attrs:{to:"/core/baseapp.html#query"}},[o("code",[e._v("Query")]),e._v(" method")]),e._v(".")],1),e._v(" "),o("li",[o("code",[e._v("queryRoute")]),e._v(" is used by "),o("code",[e._v("baseapp")]),e._v("'s "),o("RouterLink",{attrs:{to:"/core/baseapp.html#query-routing"}},[o("code",[e._v("queryRouter")])]),e._v(" to map the "),o("code",[e._v("query")]),e._v(" to its module. Usually, "),o("code",[e._v("queryRoute")]),e._v(" should be the name of the module.")],1),e._v(" "),o("li",[o("code",[e._v("queryType")]),e._v(" is used by the module's "),o("RouterLink",{attrs:{to:"/building-modules/querier.html"}},[o("code",[e._v("querier")])]),e._v(" to map the "),o("code",[e._v("query")]),e._v(" to the appropriate "),o("code",[e._v("querier function")]),e._v(" within the module.")],1),e._v(" "),o("li",[o("code",[e._v("args")]),e._v(" are the actual arguments needed to process the "),o("code",[e._v("query")]),e._v(". They are filled out by the end-user. Note that for bigger queries, you might prefer passing arguments in the "),o("code",[e._v("Data")]),e._v(" field of the request "),o("code",[e._v("req")]),e._v(" instead of the "),o("code",[e._v("path")]),e._v(".")])]),e._v(" "),o("p",[e._v("The "),o("code",[e._v("path")]),e._v(" for each "),o("code",[e._v("query")]),e._v(" must be defined by the module developer in the module's "),o("RouterLink",{attrs:{to:"/building-modules/module-interfaces.html#query-commands"}},[e._v("command-line interface file")]),e._v(".Overall, there are 3 mains components module developers need to implement in order to make the subset of the state defined by their module queryable:")],1),e._v(" "),o("ul",[o("li",[e._v("A "),o("RouterLink",{attrs:{to:"/building-modules/querier.html"}},[o("code",[e._v("querier")])]),e._v(", to process the "),o("code",[e._v("query")]),e._v(" once it has been "),o("RouterLink",{attrs:{to:"/core/baseapp.html#query-routing"}},[e._v("routed to the module")]),e._v(".")],1),e._v(" "),o("li",[o("RouterLink",{attrs:{to:"/building-modules/module-interfaces.html#query-commands"}},[e._v("Query commands")]),e._v(" in the module's CLI file, where the "),o("code",[e._v("path")]),e._v(" for each "),o("code",[e._v("query")]),e._v(" is specified.")],1),e._v(" "),o("li",[o("code",[e._v("query")]),e._v(" return types. Typically defined in a file "),o("code",[e._v("internal/types/querier.go")]),e._v(", they specify the result type of each of the module's "),o("code",[e._v("queries")]),e._v(". These custom types must implement the "),o("code",[e._v("String()")]),e._v(" method of "),o("a",{attrs:{href:"https://golang.org/pkg/fmt/#Stringer",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("fmt.Stringer")]),o("OutboundLink")],1),e._v(".")])]),e._v(" "),o("p",[e._v("See an example of "),o("code",[e._v("query")]),e._v(" return types from the "),o("code",[e._v("nameservice")]),e._v(" module:")]),e._v(" "),o("p",[o("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gUXVlcnlSZXNSZXNvbHZlIFF1ZXJpZXMgUmVzdWx0IFBheWxvYWQgZm9yIGEgcmVzb2x2ZSBxdWVyeQp0eXBlIFF1ZXJ5UmVzUmVzb2x2ZSBzdHJ1Y3QgewoJVmFsdWUgc3RyaW5nIGBqc29uOiZxdW90O3ZhbHVlJnF1b3Q7YAp9CgovLyBpbXBsZW1lbnQgZm10LlN0cmluZ2VyCmZ1bmMgKHIgUXVlcnlSZXNSZXNvbHZlKSBTdHJpbmcoKSBzdHJpbmcgewoJcmV0dXJuIHIuVmFsdWUKfQoKLy8gUXVlcnlSZXNOYW1lcyBRdWVyaWVzIFJlc3VsdCBQYXlsb2FkIGZvciBhIG5hbWVzIHF1ZXJ5CnR5cGUgUXVlcnlSZXNOYW1lcyBbXXN0cmluZwoKLy8gaW1wbGVtZW50IGZtdC5TdHJpbmdlcgpmdW5jIChuIFF1ZXJ5UmVzTmFtZXMpIFN0cmluZygpIHN0cmluZyB7CglyZXR1cm4gc3RyaW5ncy5Kb2luKG5bOl0sICZxdW90O1xuJnF1b3Q7KQp9"}})],1),e._v(" "),o("h2",{attrs:{hide:"",id:"next"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#next"}},[e._v("#")]),e._v(" Next")]),e._v(" "),o("p",{attrs:{hide:""}},[e._v("Learn about "),o("RouterLink",{attrs:{to:"/building-modules/handler.html"}},[o("code",[e._v("handler")]),e._v("s")])],1)],1)}),[],!1,null,null,null);t.default=a.exports}}]);